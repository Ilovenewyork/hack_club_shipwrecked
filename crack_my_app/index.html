// Repaired script section
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const BASE_URL = 'https://crackmyapp.netlify.app/crack_my_app/';
    const steps = Array.from(document.querySelectorAll('.step'));
    const show = i => steps.forEach((s, j) => j === i ? s.classList.remove('hidden') : s.classList.add('hidden'));
    show(0);

    const roasts = [];
    const ecsList = document.getElementById('ecs-list');

    function addEc() {
      const div = document.createElement('div');
      div.className = 'ec-card flex flex-col bg-gray-50 border border-gray-200 p-4 rounded-md';
      div.innerHTML = `
        <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0 items-center">
          <input list="ec-list" class="ec-name w-full sm:flex-1 p-2 border border-gray-300 rounded-md" placeholder="Select or type EC" />
          <input type="number" class="ec-years w-full sm:w-20 p-2 border border-gray-300 rounded-md" placeholder="yrs" min="0" max="10" />
          <input type="number" class="ec-hours w-full sm:w-20 p-2 border border-gray-300 rounded-md" placeholder="hrs/wk" min="0" max="168" />
        </div>`;
      ecsList.appendChild(div);
    }
    addEc();
    document.getElementById('add-ec').onclick = e => { e.preventDefault(); addEc(); };

    document.getElementById('start').onclick = () => show(1);
    document.getElementById('back-1').onclick = () => show(0);
    document.getElementById('next-1').onclick = () => {
      const ecs = Array.from(document.querySelectorAll('.ec-name')).map(input => input.value.trim());
      if (ecs.some(n => !n)) return alert('Fill out all EC names.');
      show(2);
    };
    document.getElementById('back-2').onclick = () => show(1);
    document.getElementById('next-2').onclick = () => {
      const gpa = document.getElementById('gpa-input').value.trim();
      if (!gpa) return alert('Please enter GPA.');
      show(3);
    };
    document.getElementById('back-3').onclick = () => show(2);
    document.getElementById('next-3').onclick = () => {
      const major = document.getElementById('major-input').value.trim();
      if (!major) return alert('Please enter major.');
      show(4);
    };
    document.getElementById('back-4').onclick = () => show(3);

    document.getElementById('next-4').onclick = () => {
      const ecs = Array.from(document.querySelectorAll('.ec-card')).map(card => ({
        name: card.querySelector('.ec-name').value.trim(),
        yrs: parseInt(card.querySelector('.ec-years').value) || 0,
        hrs: parseInt(card.querySelector('.ec-hours').value) || 0
      }));
      const gpa = parseFloat(document.getElementById('gpa-input').value) || 0;
      const major = document.getElementById('major-input').value.trim() || 'Unknown';
      const fact = document.getElementById('fact-input').value.trim() || '';

      let score = gpa;
      ecs.forEach(ec => score += Math.min(2, ec.yrs / 2) + Math.min(1, ec.hrs / 10));
      score = Math.min(10, Math.max(0, Math.round(score + (Math.random() - 0.3))));

      const commonECs = ecs.map(ec => ec.name.toLowerCase());
      const hasVolunteering = commonECs.some(name => name.includes('volunteer') || name.includes('service'));
      const hasLeadership = commonECs.some(name => name.includes('student government') || name.includes('captain') || name.includes('president'));
      const hasResearch = commonECs.some(name => name.includes('research') || name.includes('internship'));
      const hasSTEM = commonECs.some(name => name.includes('robotics') || name.includes('science') || name.includes('math') || name.includes('coding'));
      const hasSports = commonECs.some(name => name.includes('sport') || name.includes('soccer') || name.includes('basketball'));

      if (!hasVolunteering) roasts.push("ðŸ§Š No volunteering? Kindness is free, but okay.");
      if (!hasLeadership) roasts.push("ðŸ¤·â€â™‚ï¸ No leadership roles? A true background character arc.");
      if (!hasResearch && major.toLowerCase().includes('science')) roasts.push("ðŸ”¬ Wants to do science but forgot the science part.");
      if (!hasSports) roasts.push("ðŸ’ª Not an athlete? Not even intramurals?");
      if (gpa > 3.95 && ecs.length <= 2) roasts.push("ðŸ“š GPA warrior, but where are the ECs?");
      if (gpa < 2.8) roasts.push("ðŸ˜¬ GPA this low? You might be pioneering the uncharted safety zone.");
      if (major.toLowerCase().includes('linguistics')) roasts.push("ðŸ“– Linguistics? Ah yes, the noble art of decoding sarcasm in dead dialects.");
      if (major.toLowerCase().includes('philosophy')) roasts.push("ðŸ§  Philosophy major: already preparing for your future as a barista.");
      if (major.toLowerCase().includes('computer')) {
        if (!hasSTEM) roasts.push("ðŸ’» CS major without coding ECs? Bold.");
        else roasts.push("ðŸ’» CS major detected. Startup incoming... or maybe just debugging your parents' printer.");
      }
      if (fact.length < 3) roasts.push("ðŸ¤« No fun fact? Guess you're letting the mystery sell itself.");
      score = Math.max(0, Math.floor(score - 1));

      const summary = roasts[Math.floor(Math.random() * roasts.length)] || 'Balanced profile.';
      document.getElementById('final-summary').textContent = summary;
      document.getElementById('final-score').textContent = `Score: ${score}/10`;

      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
      show(5);
    };

    document.getElementById('copy-score').addEventListener('click', async () => {
      const scoreText = document.getElementById('final-score').textContent;
      const tagLine = `I played CrackMyApp and got ${scoreText}! Can you beat my score? ðŸ˜­ðŸ”¥`;
      const resultCard = document.getElementById('result-card');
      try {
        const canvas = await html2canvas(resultCard);
        canvas.toBlob(blob => {
          if (navigator.clipboard && navigator.clipboard.write) {
            const item = new ClipboardItem({ 'image/png': blob });
            navigator.clipboard.write([item]);
            alert('Score image copied! You can paste it in any chat.');
          } else {
            alert('Clipboard image copy not supported.');
          }
        });
      } catch (err) {
        alert('Failed to copy image.');
      }
    });

    document.getElementById('share-score').addEventListener('click', () => {
      const score = document.getElementById('final-score').textContent;
      const shareData = {
        title: 'My Roasted App Score',
        text: score,
        url: BASE_URL
      };
      if (navigator.share) {
        navigator.share(shareData).catch(() => {});
      } else {
        navigator.clipboard.writeText(`${score} â€” ${BASE_URL}`);
        alert('Score copied! Use it to share.');
      }
    });
  });
</script>
